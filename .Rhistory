devtools::load_all()
set_con()
devtools::check()
usethis::use_mit_license("Eric Ekholm")
devtools::document()
devtools::document()
devtools::check()
devtools::check()
devtools::install()
devtools::install()
devtools::install()
?purrr::as_vector
devtools::load_all()
length(fetch_fm_ids(2019))
length(fetch_fm_ids(2017))
#' Recode Ethnicity
#'
#' @param df data
#' @param eth_var ethnicity variable. Assumed to be "ethnic" as a result of db query and clean_names
#' @param hisp_var hispanic/latino variable. Assumed to be "hispanic_latino" as a result of db query and clean_names
#'
#' @return
#' @export
#'
#' @examples
recode_ethnicity <- function(df, eth_var = ethnic, hisp_var = hispanic_latino) {
df %>%
dplyr::mutate({{ eth_var }} := dplyr::case_when(
{{ hisp_var }} == "Y" ~ "Hispanic",
{{ hisp_var }} == "N" & {{ eth_var }} == "01" ~ "American Indian/Alaska Native",
{{ hisp_var }} == "N" & {{ eth_var }} == "02" ~ "Asian",
{{ hisp_var }} == "N" & {{ eth_var }} == "03" ~ "Black or African American",
{{ hisp_var }} == "N" & {{ eth_var }} == "05" ~ "White",
{{ hisp_var }} == "N" & {{ eth_var }} == "06" ~ "Hawaiian or Pacific Islander",
TRUE ~ "Two or More"
))
}
library(tidyverse)
library(janitor)
con <- set_con()
example <- odbc::dbGetQuery(con, 'SELECT * FROM [CCPS_Shared].[CCPS_Shared].[RE_Students] WHERE School_Year = 2019')
tst <- example %>% recode_ethnicity()
tst <- example %>% clean_names() %>% recode_ethnicity()
devtools::check()
library(devtools)
load_all()
check()
install()
?usethis::use_data()
con <- ccpsr::set_con()
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME,
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE (\'ELEMENT\' OR \'MIDDLE\' OR \'HIGH\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME,
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
--WHERE SCHOOL_TYPE LIKE (\'ELEMENT\' OR \'MIDDLE\' OR \'HIGH\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME,
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'ELEMENT\' OR SCHOOL_TYPE LIKE \'MIDDLE\' OR SCHOOL_TYPE LIKE \'HIGH\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'ELEMENT\' OR SCHOOL_TYPE LIKE \'MIDDLE\' OR SCHOOL_TYPE LIKE \'HIGH\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE (\'ELEMENT\' OR \'MIDDLE\' OR \'HIGH\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME,
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE \'ELEM\'
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE \'ELEM\'
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE \'ELEM%\'
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE SCHOOL_TYPE LIKE \'1%\'
'
))
core_schools %>% distinct(SCHOOL_TYPE)
unique(core_schools$SCHOOL_TYPE)
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2\' OR SCHOOL_TYPE LIKE \'3\')
'
))
core_schools <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
SCHOOL_TYPE,
ORGANIZATION_NAME
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2%\' OR SCHOOL_TYPE LIKE \'3%\')
'
))
unique(core_schools$SCHOOL_TYPE)
core_school_codes <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE,
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2%\' OR SCHOOL_TYPE LIKE \'3%\')
'
))
core_school_codes <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2%\' OR SCHOOL_TYPE LIKE \'3%\')
'
))
core_codes <- as.vector(core_school_codes)
core_codes <- as.numeric(core_school_codes)
readr::write_csv(core_codes, here::here("data-raw/core_codes.csv"))
usethis::use_data(core_codes, overwrite = TRUE)
?save
save(core_codes, file = here::here("data/core_codes.RData"))
library(tidyverse)
core_codes <- pull(core_school_codes)
core_codes <- pull(core_school_codes) %>%
as_numeric()
core_codes <- pull(core_school_codes) %>%
as.numeric()
save(core_codes, file = here::here("data/core_codes.RData"))
library(tidyverse)
con <- ccpsr::set_con()
core_school_codes <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2%\' OR SCHOOL_TYPE LIKE \'3%\')
'
))
core_school_codes <- pull(core_school_codes) %>%
as.numeric()
#writing out
save(core_school_codes, file = here::here("data/core_codes.RData"))
library(tidyverse)
con <- ccpsr::set_con()
core_school_codes <- odbc::dbGetQuery(con, paste0(
'SELECT SCHOOL_CODE
FROM [CCPS_Shared].[CCPS_Shared].[RE_Organizations]
WHERE (SCHOOL_TYPE LIKE \'1%\' OR SCHOOL_TYPE LIKE \'2%\' OR SCHOOL_TYPE LIKE \'3%\')
'
))
core_school_codes <- pull(core_school_codes) %>%
as.numeric()
#writing out
save(core_school_codes, file = here::here("data/core_school_codes.RData"))
tmp <- odbc::dbGetQuery(con, paste0('
SELECT StudentId,
State_School
FROM [CCPS_Shared].[SCHOOLS\\Susan_Kvaven].[SRC_FALL_', year, ']
WHERE ActiveStat = \'A\'
AND (ServDiv = 021
OR Tuition in (\'3\', \'7\')
)
AND FTE in (\'\')
'
))
